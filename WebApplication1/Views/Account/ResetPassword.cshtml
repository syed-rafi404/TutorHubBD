@model TutorHubBD.Web.Models.ViewModels.ResetPasswordViewModel
@{
    ViewData["Title"] = "Reset Password";
}

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="glass-card p-5">
                <div class="text-center mb-4">
                    <div class="mb-3">
                        <i class="bi bi-shield-lock" style="font-size: 4rem; color: #667eea;"></i>
                    </div>
                    <h2 class="mb-1">Reset Password</h2>
                    <p class="text-white-50">
                        Enter the verification code sent to<br/>
                        <strong class="text-white">@Model.Email</strong>
                    </p>
                </div>

                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="bi bi-check-circle-fill me-2"></i>@TempData["SuccessMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                @if (TempData["ErrorMessage"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>@TempData["ErrorMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <form method="post" asp-action="ResetPassword">
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                    
                    <input type="hidden" asp-for="Email" />

                    <div class="mb-3">
                        <label asp-for="OtpCode" class="form-label text-white">Verification Code</label>
                        <input asp-for="OtpCode" 
                               class="form-control form-control-lg text-center" 
                               placeholder="000000"
                               maxlength="6"
                               autocomplete="one-time-code"
                               inputmode="numeric"
                               pattern="[0-9]*"
                               style="letter-spacing: 10px; font-size: 1.5rem; font-weight: bold;" />
                        <span asp-validation-for="OtpCode" class="text-danger small"></span>
                    </div>

                    <div class="form-floating mb-3">
                        <input asp-for="NewPassword" class="form-control" placeholder="New Password" />
                        <label asp-for="NewPassword">New Password</label>
                        <span asp-validation-for="NewPassword" class="text-danger small"></span>
                    </div>

                    <div class="form-floating mb-4">
                        <input asp-for="ConfirmPassword" class="form-control" placeholder="Confirm Password" />
                        <label asp-for="ConfirmPassword">Confirm Password</label>
                        <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                    </div>

                    <button type="submit" class="btn btn-gradient w-100 py-3 mb-3">
                        <i class="bi bi-check-circle me-2"></i>Reset Password
                    </button>
                </form>

                <div class="text-center mt-3">
                    <p class="text-white-50 mb-2">Didn't receive the code?</p>
                    <form method="post" asp-action="ResendOtp" class="d-inline">
                        <input type="hidden" name="email" value="@Model.Email" />
                        <input type="hidden" name="purpose" value="@TutorHubBD.Web.Models.OtpPurpose.PasswordReset" />
                        <button type="submit" class="btn btn-link text-white fw-bold p-0">
                            <i class="bi bi-arrow-clockwise me-1"></i>Resend Code
                        </button>
                    </form>
                </div>

                <div class="text-center mt-4">
                    <a asp-action="ForgotPassword" class="text-white-50">
                        <i class="bi bi-arrow-left me-1"></i>Back
                    </a>
                </div>

                <div class="mt-4 p-3 rounded" style="background: rgba(255,255,255,0.1);">
                    <small class="text-white-50">
                        <i class="bi bi-info-circle me-1"></i>
                        The verification code will expire in 10 minutes. Your new password must be at least 6 characters long.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Auto-focus and format OTP input
        document.addEventListener('DOMContentLoaded', function() {
            const otpInput = document.getElementById('OtpCode');
            if (otpInput) {
                otpInput.focus();
                
                // Only allow numbers
                otpInput.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            }
        });
    </script>
}
